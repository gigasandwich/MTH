\begin{align*}
    y' (1 - \sin x \cos x) + y^2 \cos x - y + \sin x &= 0 \\
    (1 - \sin x \cos x)y' - y + \cos x y^2 &= - \sin x \quad (E)
\end{align*}

On pose $y = \frac{1}{z} + \cos x$, alors $y' = - \frac{z'}{z^2}$.

(1) dans (E) :
\begin{align*}
    (1 - \sin x \cos x)\left(-\frac{z'}{z^2}\right) - \left(\frac{1}{z} + \cos x\right) + \cos x \left(\frac{1}{z} + \cos x\right)^2 &= - \sin x.
\end{align*}

Developpement :
\begin{align*}
    -\frac{z'}{z^2} + \frac{z' \sin x \cos x}{z^2} + \sin^2 x \cos x - \frac{1}{z} - \cos x &+ \cos x \left(\frac{1}{z^2} + \frac{2 \cos x}{z} + \cos^2 x \right) = 0.
\end{align*}

Developpement de $\cos x \left(\frac{1}{z} + \cos x \right)^2$ :
\begin{align*}
    \cos x \left( \frac{1}{z^2} + \frac{2 \cos x}{z} + \cos^2 x \right) &= \frac{\cos x}{z^2} + \frac{2 \cos^2 x}{z} + \cos^3 x.
\end{align*}

Avec $\cos^3 x = (1 - \sin^2 x) \cos x$ :
\begin{align*}
    \cos^3 x &= \cos x - \sin^2 x \cos x.
\end{align*}

Substitution dans (E) :
\begin{align*}
    - \frac{z'}{z^2} + \frac{z' \sin x \cos x}{z^2} - \frac{1}{z} + \sin^2 x \cos x - \cos x &+ \frac{\cos x}{z^2} + \frac{2 \cos^2 x}{z} + \cos x - \sin^2 x \cos x = 0.
\end{align*}

Rearrangement :
\begin{align*}
    (\sin x \cos x - 1) z' + (2 \cos^2 x - 1) z &= - \cos x.
\end{align*}

Hypothese $z_0 = \lambda e^{\varphi(x)}$, o√π
\begin{align*}
    \varphi(x) &= \int \frac{- (2 \cos^2 x - 1)}{(\sin x \cos x - 1)} dx.
\end{align*}

Calcul de $I$ :
\begin{align*}
    I = \int \frac{2 \cos^2 x - 1}{\sin x \cos x - 1} dx.
\end{align*}

Avec $2 \cos^2 x - 1 = \cos 2x$ :
\begin{align*}
    I &= \int \frac{\cos 2x}{\sin 2x - 2} dx.
\end{align*}

Changement de variable $u = \sin 2x - 2$, $du = 2 \cos 2x dx$ :
\begin{align*}
    I &= \int \frac{du}{u} = \ln |u| + C = \ln |\sin 2x - 2| + C.
\end{align*}

Expression de $z_0$ :
\begin{align*}
    z_0 &= K (\sin 2x - 2)^{-1}.
\end{align*}

(3) dans (E) :
\begin{align*}
    (\sin x \cos x - 1) K' (\sin 2x - 2)^{-1} - 2K \cos 2x (\sin 2x - 2)^{-2} &= - \cos x.
\end{align*}

Resolution :
\begin{align*}
    K' &= -2 \cos x, \quad K = -2 \sin x + \varepsilon.
\end{align*}

Solution finale : 
\boxed {y = \frac{\sin 2x - 2}{-2 \sin x + \varepsilon} + \cos x, \quad \varepsilon \in \mathbb{R}}

